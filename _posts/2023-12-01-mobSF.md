![image](https://github.com/radha-m0wn1ka/radha-m0wn1ka.github.io/assets/64199052/b04a028b-575a-4fd7-86a5-48de6aa6347b)![image](https://github.com/radha-m0wn1ka/radha-m0wn1ka.github.io/assets/64199052/4f962df4-94d9-474c-b60a-837e62f9ee6d)# mobSF

## resources
```
https://book.hacktricks.xyz/mobile-pentesting/android-app-pentesting
https://ajinabraham.com/blog/
https://approov.io/blog/how-to-extract-an-api-key-from-a-mobile-app-with-static-binary-analysis
https://danishzia.medium.com/diva-android-app-walkthrough-bce72b7f273a
https://payatu.com/blog/damn-insecure-and-vulnerable-app/
https://mas.owasp.org/crackmes/
https://support.corellium.com/integrations/developer-tools/mobsf
https://mas.owasp.org/MASTG/Intro/0x03-Overview/
```
## 01-12-2023
```
https://youtu.be/1NIQs82n3nw?si=VikecVArLXk34SnK
https://medium.com/@debasishkumardas5/secure-your-mobile-apps-with-mobsf-a-comprehensive-guide-to-android-and-ios-security-analysis-2ae7c928bf1d
https://github.com/tjunxiang92/Android-Vulnerabilities
https://github.com/payatu/diva-android
https://medium.com/@Kamal_S/mobile-security-framework-mobsf-setup-kali-linux-and-windows-afb055721c41
```
## mobsf
```
It consists of a server component that runs on a host machine and a client component that is installed on the mobile device.
 The client component is responsible for collecting data from the mobile device, which is then analysed by the server component.
```
### features
```
Integration with CI/CD
Reverse Engineering
Static Analysis
Dynamic Analysis
Automated Security Scanning
```
### Static analysis
is a process of analysing the code of the mobile application without actually executing it.
### what does report contain
```
severity rating for each vulnerability,
vulnerabilities
components used
permissions asked
```
### dynamic analysis
```
Dynamic analysis is a process of analysing the behaviour of the mobile application while it is running

analysing the network traffic generated by the application,running the application in a simulated environment
how does dynamic analysis work
dynamic analysis of an Android or iOS application, you need to upload the application to MobSF and then install it on a device or emulator.
 Once the application is installed, you can use MobSF to capture the network traffic generated by the application
(URLs accessed by the application, the parameters passed in the requests, and the responses received from the server.)
```
## downloading and installing
https://allabouttesting.org/quick-tutorial-mobsf-installation-on-linux-windows/
```
non functional club mobsf part1 video
install docker
https://mobsf.github.io/docs/#/mobsf_docker?id=run
docker run -it --rm -p 8000:8000 opensecurity/mobile-security-framework-mobsf:latest


```
![image](https://github.com/radha-m0wn1ka/radha-m0wn1ka.github.io/assets/64199052/d15250eb-492e-4718-ada0-59b93345b473)
![image](https://github.com/radha-m0wn1ka/radha-m0wn1ka.github.io/assets/64199052/a1ca5bfd-c092-48ca-a478-e54541d69329)
![image](https://github.com/radha-m0wn1ka/radha-m0wn1ka.github.io/assets/64199052/4f5ed9fb-7c9f-45fe-9ef3-b826447e16e0)
![image](https://github.com/radha-m0wn1ka/radha-m0wn1ka.github.io/assets/64199052/484c85e4-3e1a-4fe9-8c02-c60412196efb)
![image](https://github.com/radha-m0wn1ka/radha-m0wn1ka.github.io/assets/64199052/e504a341-0bf1-4997-b935-5663161dfbe9)
![image](https://github.com/radha-m0wn1ka/radha-m0wn1ka.github.io/assets/64199052/1e038ac8-9e17-49a2-b9b6-07991c5c7c17)
## ....
```
download+install-1hour
intro video      -.5hour
blogs reading+random youtube videos  - .5hour
dragging apks and seeing results(working of tool) -.5 hour

```
## 02-12-2023
### useful resources
 https://www.synacktiv.com/sites/default/files/2022-07/PTS2022-Talk-19-MobSF-for-penetration-testers_0.pdf
 ```
APK (Android Package Kit)

A ZIP file containing program's code (such as .dex files), libraries,
resources, assets, certificates, and manifest file

```
### taint analysis
```
Taint analysis is a process used in information security to identify the flow of user input through a system to understand the security implications of the system design.
```
![image](https://github.com/radha-m0wn1ka/radha-m0wn1ka.github.io/assets/64199052/346c35e1-600f-411c-9f78-c9e18fbdffbd)
### architecuture
![image](https://github.com/radha-m0wn1ka/radha-m0wn1ka.github.io/assets/64199052/a7b93d73-c899-4d3a-a472-f5981ddae5dd)
### manifest analysis
```
 The manifest file record also reveals the security flaws found in
the target application

```

## mobsf tool explanation
https://systemweakness.com/mobsf-an-automated-mobile-security-framework-ed93fb47b7b2
### andorid emulator
```
in computing, an emulator is hardware or software that enables one computer system (called the host) to behave like another computer system (called the guest).
An Android emulator is a tool that creates virtual Android devices (with software and hardware) on your computer
```

### dynamic analysis using geanymotion
```
https://medium.com/@hacker7744/mobile-app-security-testing-setting-up-mobsf-dynamic-analyzer-for-security-testing-of-android-ios-173db5cae81e

https://www.youtube.com/watch?v=Cxuj8IJQhoQ
```
![image](https://github.com/radha-m0wn1ka/radha-m0wn1ka.github.io/assets/64199052/87c384e6-3175-4db4-bb0e-75aa139e3f92)
![image](https://github.com/radha-m0wn1ka/radha-m0wn1ka.github.io/assets/64199052/df78fe85-8dc2-4d34-80cc-64600d47f8b0)
![image](https://github.com/radha-m0wn1ka/radha-m0wn1ka.github.io/assets/64199052/552c4be4-ddd0-4bf7-a75e-9e34a4651279)

## issue
![image](https://github.com/radha-m0wn1ka/radha-m0wn1ka.github.io/assets/64199052/2b8ab692-4308-4cd1-a51a-ac585746cf57)
```
try
docker run -e MOBSF_ANALYZER_IDENTIFIER=your_android_identifier -p 8000:8000 mobsf
192.168.69.101:5555
docker run -e MOBSF_ANALYZER_IDENTIFIER=192.168.69.101:5555 -p 8000:8000 mobsf
in this case image name is 6fb1f6bb372c
docker run -e MOBSF_ANALYZER_IDENTIFIER=192.168.69.101:5555 -p 8000:8000 6fb1f6bb372c
```
![image](https://github.com/radha-m0wn1ka/radha-m0wn1ka.github.io/assets/64199052/9f474ee1-2e14-4f66-bd6c-31cf4010658d)
![image](https://github.com/radha-m0wn1ka/radha-m0wn1ka.github.io/assets/64199052/eb7355a0-b971-4f98-a1c7-ade76daad7aa)
## nat bridge host-only
https://www.makeuseof.com/whats-the-difference-nat-bridge-host-only-network-modes/

## dynamic analysis
![image](https://github.com/radha-m0wn1ka/radha-m0wn1ka.github.io/assets/64199052/b6e5f695-5ca5-4c42-94f9-bf5d5a450fad)
![image](https://github.com/radha-m0wn1ka/radha-m0wn1ka.github.io/assets/64199052/4e7cddd1-7e53-4170-b790-031ac5105da8)
![image](https://github.com/radha-m0wn1ka/radha-m0wn1ka.github.io/assets/64199052/b75fedcb-ad49-4107-8d67-0e07c90a6bfd)
drag and drop the apk to do dynamic analysis
![image](https://github.com/radha-m0wn1ka/radha-m0wn1ka.github.io/assets/64199052/34374d83-053b-42d3-9089-af1190884331)
after dragging the file and dropping in the emulator ,we cann see them in dynamic anlysis part
![image](https://github.com/radha-m0wn1ka/radha-m0wn1ka.github.io/assets/64199052/65a01535-31d6-4499-9b2a-06ee2e33e13c)
then selecting one applicaiton will lead to this screen
![image](https://github.com/radha-m0wn1ka/radha-m0wn1ka.github.io/assets/64199052/7bc9eb66-66e5-4c96-a48d-e92fae9e24cb)
at the same time we can see our testing application running (in this case application made by me using react natvie)running in emulator
![image](https://github.com/radha-m0wn1ka/radha-m0wn1ka.github.io/assets/64199052/53c417f4-c2c2-4adc-a322-f7bb65343317)

## dynamic analysis of viber app
![image](https://github.com/radha-m0wn1ka/radha-m0wn1ka.github.io/assets/64199052/c7a1a0a7-ef87-4571-b4de-4b63eba3b434)
## generating report 
click on generate report and wait for a while
![image](https://github.com/radha-m0wn1ka/radha-m0wn1ka.github.io/assets/64199052/262b470a-74ca-4ebb-a73f-48ea85b41456)
## raw logs
by clicking on raw logs options we can see request reponse cycle
## tesing another applicaiton
clearly we can see the vulnerability ,the leakage of tokens,plain transfer of critical data such as passwords
![image](https://github.com/radha-m0wn1ka/radha-m0wn1ka.github.io/assets/64199052/3f9ef3e6-0cb8-4f06-91e4-65132fb6c9b8)
![image](https://github.com/radha-m0wn1ka/radha-m0wn1ka.github.io/assets/64199052/52d2ec36-5f8e-462c-9e08-3034c7c55091)
urls section is disclosing backend urls used
![image](https://github.com/radha-m0wn1ka/radha-m0wn1ka.github.io/assets/64199052/92fd04b1-3384-47e1-a279-72fde8d45a82)
## cleaning up and clearing
```
stop the virtul device
stop the container service in docker app
docker desktop .exe is still running in background
kill it by wsl --shutdown in powershell
```
![image](https://github.com/radha-m0wn1ka/radha-m0wn1ka.github.io/assets/64199052/119d94f5-f70a-4fb5-b4bc-b038666ffcf6)
## ....
```
dynamic analysis tools download(geany motion+andorid apks inside it)-1hour
dynamic analysis reading article and watching youtube videos -1hour
perfroming dynamic analysis on 2 apks and analyzing the results -1hour
```
# 03-12-2023
## today learning resources
https://resources.infosecinstitute.com/topics/penetration-testing/android-penetration-tools-walkthrough-series-mobsf/
^did not work well for me
### folder structure
![image](https://github.com/radha-m0wn1ka/radha-m0wn1ka.github.io/assets/64199052/b889ff0d-bbe8-4061-880f-c8c8fd21bb33)

chatgpt helped:)

```
.dockerignore: This file is used to specify which files and directories should be excluded from Docker builds.

.github: This directory likely contains configuration files or scripts related to GitHub. GitHub Actions or other GitHub-specific configurations may be present here.

.gitignore: This file specifies intentionally untracked files that Git should ignore.

.gitmodules: This file is used to include other Git repositories as submodules.

.pyup.yml: This file might be related to Python package updates.

.sonarcloud.properties: This file could contain configuration settings for integration with SonarCloud, a platform for continuous inspection of code quality.

docker-compose.yml: This file is a Docker Compose configuration file. It defines services, networks, and volumes for a Docker application.

Dockerfile: This file contains instructions for building a Docker image. It specifies the base image, dependencies, and commands to be run.

LICENSE: This file typically contains the license under which the Mobile-Security-Framework (MobSF) is distributed.

LICENSES: This directory may contain licenses for dependencies or components used by MobSF.

manage.py: This is a common filename for Django projects and is used for various management tasks, such as running development servers and applying database migrations.

mobsf: This directory likely contains the source code and other resources for the MobSF application.

poetry.lock: This file is generated by the Poetry dependency manager for Python. It locks the dependencies to specific versions to ensure consistency across different environments.

pyproject.toml: This file is used by Poetry to define project metadata and dependencies.

README.md: This file typically contains information about the project, including how to install, configure, and use it.

run.bat: This is a Windows batch file that likely contains commands to run or configure MobSF.

run.sh: This is a Unix shell script that likely contains commands to run or configure MobSF. It's intended for Unix-like systems (Linux, macOS).

scripts: This directory probably contains additional scripts or utilities used in the project.

setup.bat: This is likely a Windows batch script used for setting up or configuring MobSF.

setup.sh: This is likely a Unix shell script used for setting up or configuring MobSF.

tox.ini: This file is used by the tox testing tool. It may contain configuration for running tests in different environments.
```
### custorm runnig not wokring
![image](https://github.com/radha-m0wn1ka/radha-m0wn1ka.github.io/assets/64199052/daf81158-1f22-46b5-8a27-1faa1d7f09d4)
## running by cloning the source code
 ```
pip install django poetry
https://medium.com/@Kamal_S/mobile-security-framework-mobsf-setup-kali-linux-and-windows-afb055721c41
https://github.com/MobSF/Mobile-Security-Framework-MobSF/blob/master/mobsf/install/windows/readme.md
https://www.youtube.com/watch?v=17ilENuMj58
```
on running setup.bat
![image](https://github.com/radha-m0wn1ka/radha-m0wn1ka.github.io/assets/64199052/d970e78b-46f7-492f-9e2a-63181d18cf02)
![image](https://github.com/radha-m0wn1ka/radha-m0wn1ka.github.io/assets/64199052/0470f724-879a-44eb-b397-b0dfddfd6b85)
## what is open ssl
https://thesecmaster.com/procedure-to-install-openssl-on-the-windows-platform/
now after installing open ssl run setup.bat
![image](https://github.com/radha-m0wn1ka/radha-m0wn1ka.github.io/assets/64199052/9e0efa16-57d8-4114-9ea6-e6ee149470eb)
![image](https://github.com/radha-m0wn1ka/radha-m0wn1ka.github.io/assets/64199052/209a9245-4716-4c7d-9603-f5b2a9569242)
stuck at 14.3 s for a long time,close the window,again run setup.bat<br>
while trying run.bat
![image](https://github.com/radha-m0wn1ka/radha-m0wn1ka.github.io/assets/64199052/7626ab73-1e4e-4536-9a2d-9692f4d5edc3)


### tool to convert md to pdf
https://products.aspose.app/pdf/conversion/md-to-pdf
## toread
```
https://dev.to/aviyel/integrating-mobsf-rest-api-in-react-js-59i6
https://www.youtube.com/watch?v=ZxaV-jne2WA
```
# 04-12-2023
```
automate testing via mobsf using apis
https://www.slideshare.net/ajin25/nullcon-goa-2016-automated-mobile-application-security-testing-with-mobile-security-framework-mobsf
```
![image](https://github.com/radha-m0wn1ka/radha-m0wn1ka.github.io/assets/64199052/32b92eaa-3fc7-4fe0-b025-233f69f6ec35)
```
web api fuzzer
https://medium.com/@kshitishirke/mobile-security-framework-mobsf-static-analysis-df22fcdae46e
MobSF can do dynamic application testing at runtime for Android apps and has Web API fuzzing capabilities powered by CapFuzz, a Web API specific security scanner.
```

### issue
```
while trying to run setup.bat
the process halts in cmd at line
trying to delte folder c:users/myname/.MobSF
and it halts just like that  and 100% disk usage warning comes
so try to create a empty folder at the specified destination so that cmd can delete the folder and continue its execution smoothly
```
### issue
```
now after successfully running setup.bat now when running run.bat
error comes saying poetry is not recognized
```
#### poetry
```
Poetry is a tool for dependency management and packaging in Python. It allows you to declare the libraries your project depends on and it will manage (install/update) them for you. Poetry offers a lockfile to ensure repeatable installs, and can build your project for distribution

https://python-poetry.org/docs/

```
![image](https://github.com/radha-m0wn1ka/radha-m0wn1ka.github.io/assets/64199052/b86c3b56-32c9-4936-a47a-187aaacd0c45)
```
now we need pipx
https://github.com/pypa/pipx

pipx — Install and Run Python Applications in Isolated Environments

python3 -m pip install --user pipx




c:\users\radha\appdata\local\packages\pythonsoftwarefoundation.python.3.11_qbz5n2kfra8p0\localcache\local-packages\python311\scripts\
at this path run this
.\pipx.exe ensurepath

```
![image](https://github.com/radha-m0wn1ka/radha-m0wn1ka.github.io/assets/64199052/41a8dd18-1664-43d6-b4c1-ca4c68a445af)
restart terminal
![image](https://github.com/radha-m0wn1ka/radha-m0wn1ka.github.io/assets/64199052/29584aa4-b7a0-4617-9e5d-e85de47b2775)
```
now install poetry
pipx install poetry
```
### issue
```
the issue is we need to create a virtual environment and then install our dependencies using pipx
.\myenv\Scripts\activate

```
![image](https://github.com/radha-m0wn1ka/radha-m0wn1ka.github.io/assets/64199052/1aea7569-b67f-4ec0-aad3-e648922aba96)

![image](https://github.com/radha-m0wn1ka/radha-m0wn1ka.github.io/assets/64199052/437048a5-b6af-4c4c-baf2-37f6d6c9cacd)

![image](https://github.com/radha-m0wn1ka/radha-m0wn1ka.github.io/assets/64199052/bc0f6908-8632-44db-91ac-b9897f0b2296)
```
now i tried to run.bat 127.0.0.1:8000
```
![image](https://github.com/radha-m0wn1ka/radha-m0wn1ka.github.io/assets/64199052/0766834e-c766-4238-8e77-1cc6cb288d75)
```
now i ran here $setup.bat
```
in the middle
![image](https://github.com/radha-m0wn1ka/radha-m0wn1ka.github.io/assets/64199052/57c571c1-70f2-46ad-abb9-1d281dd4ff31)
![image](https://github.com/radha-m0wn1ka/radha-m0wn1ka.github.io/assets/64199052/050854c6-3b57-4f7f-9b37-09c9f7eb22ea)

![image](https://github.com/radha-m0wn1ka/radha-m0wn1ka.github.io/assets/64199052/c8b09b89-7879-49af-a77b-1a341ed278b1)
![image](https://github.com/radha-m0wn1ka/radha-m0wn1ka.github.io/assets/64199052/eb55b976-8bdf-449f-a300-63c5703ed0bf)

![image](https://github.com/radha-m0wn1ka/radha-m0wn1ka.github.io/assets/64199052/dc6e0245-07ff-426b-929c-dc987e3a6452)
## finally got mobsf running on port 8000
![image](https://github.com/radha-m0wn1ka/radha-m0wn1ka.github.io/assets/64199052/56d77c08-1469-436e-98c6-a284026f64bc)
## nice basics
https://book.hacktricks.xyz/mobile-pentesting/android-app-pentesting
## smali dex
```
in mobsf analysis we can see a dedicated space for smali code and dex
Most Android applications are written in Java. Kotlin is also supported and interoperable with Java.  Instead of the Java code being run in Java Virtual Machine (JVM) like desktop applications, in Android, the Java is compiled to the _Dalvik Executable (DEX) bytecode_** format**. For earlier versions of Android, the bytecode was translated by the Dalvik virtual machine. For more recent versions of Android, the Android Runtime (ART) is used.
If developers, write in Java and the code is compiled to DEX bytecode, to reverse engineer, we work the opposite direction.
```
![image](https://github.com/radha-m0wn1ka/radha-m0wn1ka.github.io/assets/64199052/69ae058a-8dda-4fc7-ab47-c04762b2fdcd)
```
Smali is the human readable version of Dalvik bytecode. Technically, Smali and baksmali are the name of the tools (assembler and disassembler, respectively), but in Android, we often use the term “Smali” to refer to instructions. If you’ve done reverse engineering or computer architecture on compiled C/C++ code. SMALI is like the assembly language: between the higher level source code and the bytecode.
```
### intents
```
Intents are the primary means by which Android apps communicate between their components or with other apps
```
### components
These include: Activities, Services, Broadcast Receivers and Providers.
####  activity
```
launcher activity
An Android activity is one screen of the Android app's user interface. In that way an Android activity is very similar to windows in a desktop application. An Android app may contain one or more activities, meaning one or more screens.
not every application will have a launcher activity, especially apps without a UI. Examples of applications without a UI (and thus a launcher activity) are pre-installed applications that perform services in the background, such as voicemail.
```
#### services
```
Services run in the background without a UI. They are used to perform long-running processes, even if the user starts using a different application.
```
#### webviews
```
WebViews
WebViews are effectively web browsers embedded into Android Apps.
WebViews content can be pulled from remote sites or can be files included in the app.
WebViews are vulnerable to the same vulnerabilities affecting any web browsers. However there are some configurations that can be useful to limit the attack surface.
```
## using api calls to automate mobsf
### resource
https://gist.github.com/ajinabraham/0f5de3b0c7b7d3665e54740b9f536d81
```
pip install the dependencies requests,requests_jsonbelt
activate virtaul env then run  run.bat 127.0.0.1:8000
in another terminal in the corresponding directory
run the present at the above git
the below error occurs ,we need to find the api key
may be try manually insert diva apk find strigs for api key and automate it 
```
![image](https://github.com/radha-m0wn1ka/radha-m0wn1ka.github.io/assets/64199052/ee6a3c69-6332-43e0-b6f2-6da48d2cfa72)
![image](https://github.com/radha-m0wn1ka/radha-m0wn1ka.github.io/assets/64199052/9ce66a31-cb0c-42fe-a058-f8bd1f612de7)
```
the api keys are not woking and the error reapring let us try another app for which we know api key
then modify the api calls code with our api key and new apk
can find api key in many apps manifest.xml 
```
```
now trying this site
https://approov.io/blog/how-to-extract-an-api-key-from-a-mobile-app-with-static-binary-analysis
and this api key
tried this did not work,triend base64 decode which happens to be api-key-stored-in-manifest-file
still did not work
```
![image](https://github.com/radha-m0wn1ka/radha-m0wn1ka.github.io/assets/64199052/92cd734a-fb8d-4c0e-a911-b87e41ffff6f)
![image](https://github.com/radha-m0wn1ka/radha-m0wn1ka.github.io/assets/64199052/d3f52748-4f3d-43c6-9531-bc6032a53908)
## ....
```
using mobsf by directly installing in the system without docker
understaing how to use api calls(not implemented as unable to have no api key)
basics of andorid security article reading in hacktricks.xyz site
```
# 5-12-2023
## resources
```
https://mobsf.live/api_docs
https://github.com/MobSF/docs/blob/master/extras.md
```
### trying calls
```
curl -F 'file=@/Users/radha/Desktop/diva-beta.apk' http://localhost:8000/api/v1/upload -H "Authorization:78116ec8ff766f54c9e68311eb3102f9fbc2fc1aaf6006ad45af402f6bc31601"


curl -F 'file=@/Users/radha/Desktop/diva-beta.apk' http://localhost:8000/api/v1/upload -H "X-Mobsf-Api-Key:78116ec8ff766f54c9e68311eb3102f9fbc2fc1aaf6006ad45af402f6bc31601"
```
![image](https://github.com/radha-m0wn1ka/radha-m0wn1ka.github.io/assets/64199052/e607fb6c-adf7-4d21-8a8e-d6ff9910e28e)
```
curl -F 'file=@diva-beta.apk' http://localhost:8000/api/v1/upload -H "Authorization:78116ec8ff766f54c9e68311eb3102f9fbc2fc1aaf6006ad45af402f6bc31601"


curl -F 'file=@diva-beta.apk' http://localhost:8000/api/v1/upload -H "X-Mobsf-Api-Key:78116ec8ff766f54c9e68311eb3102f9fbc2fc1aaf6006ad45af402f6bc31601"
```
![image](https://github.com/radha-m0wn1ka/radha-m0wn1ka.github.io/assets/64199052/2cb0bc35-c070-41a4-836c-76ba52e4d8ff)
as suggested in stakcoverflow removed ' then
![image](https://github.com/radha-m0wn1ka/radha-m0wn1ka.github.io/assets/64199052/20d38fcf-44d3-4c33-9767-420ecddc8b05)
```
after searching in internet for a while found a local url
```
![image](https://github.com/radha-m0wn1ka/radha-m0wn1ka.github.io/assets/64199052/108732be-0d4d-4751-a6c0-38f90751824c)
![image](https://github.com/radha-m0wn1ka/radha-m0wn1ka.github.io/assets/64199052/a150c20d-39a7-4387-8043-86c1ea7c7394)

```
by looking clerly the api key is differnt
so we must use our own api key for our local testing
```
![image](https://github.com/radha-m0wn1ka/radha-m0wn1ka.github.io/assets/64199052/f34accd6-210e-4b41-91db-131e2d63ad08)
```
our api key in this case
b76ac0ea071e987b9519ca6da8bf671561b0979e6a4f0717eb4f703099bc086c


curl -F file=@diva-beta.apk http://127.0.0.1:8000/api/v1/upload -H "Authorization:b76ac0ea071e987b9519ca6da8bf671561b0979e6a4f0717eb4f703099bc086c"
^did not work same error u are unauthorised to make this request


curl -F 'file=@/Users/radha/Desktop/diva-beta.apk' http://localhost:8000/api/v1/upload -H "Authorization:b76ac0ea071e987b9519ca6da8bf671561b0979e6a4f0717eb4f703099bc086c"
^falied to open data from appliation

curl -F file=@/Users/radha/Desktop/diva-beta.apk http://localhost:8000/api/v1/upload -H "Authorization:b76ac0ea071e987b9519ca6da8bf671561b0979e6a4f0717eb4f703099bc086c"
^u are unatuthoried

curl -F file=diva-beta.apk http://localhost:8000/api/v1/upload -H "Authorization:b76ac0ea071e987b9519ca6da8bf671561b0979e6a4f0717eb4f703099bc086c"
^u are unatuthoried
looks like the reason is we are running using docker and the ip address is not accessable from cmd as can be seen here
```
![image](https://github.com/radha-m0wn1ka/radha-m0wn1ka.github.io/assets/64199052/f24be224-d507-458c-880b-81b0fdc79615)
## using custom mobsf 
```
after activating the venv run run.bat 127.0.0.1:8000
at location we find http://127.0.0.1:8000/api_docs
c086ee4154e11b189d2a4a20daf40b5158bfd301784a46bbff4a5ff207389774:api key

sample call1
curl -F file=@/Users/radha/Desktop/diva-beta.apk http://localhost:8000/api/v1/upload -H "Authorization:c086ee4154e11b189d2a4a20daf40b5158bfd301784a46bbff4a5ff207389774"

dont use quotations aroung file as it would lead to error  saying failed to open loal data from applicaiton
```
![image](https://github.com/radha-m0wn1ka/radha-m0wn1ka.github.io/assets/64199052/402a39ab-c6ca-4f1d-b58e-27d97b88dae8)

# static analysis
api key :c086ee4154e11b189d2a4a20daf40b5158bfd301784a46bbff4a5ff207389774
## api/v1/upload - Upload a File
```
curl -F file=@/Users/radha/Desktop/diva-beta.apk http://localhost:8000/api/v1/upload -H "Authorization:c086ee4154e11b189d2a4a20daf40b5158bfd301784a46bbff4a5ff207389774"
request part:
file authorization key
url
response part:
analyser type:static
status of request:success
hash value:...
scantype:apk
filename:
```
![image](https://github.com/radha-m0wn1ka/radha-m0wn1ka.github.io/assets/64199052/b0bc389a-49d7-4734-94e6-e067c31a8485)
## scanning a file
```

curl -X POST --url http://localhost:8000/api/v1/scan --data "hash=77a9be5009f7ca26534b58fe57f8d712" -H "Authorization:c086ee4154e11b189d2a4a20daf40b5158bfd301784a46bbff4a5ff207389774"

API to scan a file that is already uploaded
requests:
url
method:post
header:authorization
hash of file to scan (which is return druing upload)
response:
got a big response
```
![image](https://github.com/radha-m0wn1ka/radha-m0wn1ka.github.io/assets/64199052/3a95a9a8-bbde-4bbb-8a0a-c5a9ed26bc38)
## display recent scans api
```
sample call:
curl --url "http://localhost:8000/api/v1/scans?page=1&page_size=10" -H "Authorization:c086ee4154e11b189d2a4a20daf40b5158bfd301784a46bbff4a5ff207389774"

request part:
method:get
header:authorization
page page size
response:
{"content": [{"ANALYZER": "static_analyzer", "SCAN_TYPE": "apk", "FILE_NAME": "diva-beta.apk", "APP_NAME": "Diva", "PACKAGE_NAME": "jakhar.aseem.diva", "VERSION_NAME": "1.0", "MD5": "77a9be5009f7ca26534b58fe57f8d712", "TIMESTAMP": "2023-12-05T07:46:31.265Z"}], "count": 1, "num_pages": 1}
```
![image](https://github.com/radha-m0wn1ka/radha-m0wn1ka.github.io/assets/64199052/d3cbdb8c-18ef-49dc-bb99-5023ec0de3a3)
## delete scan api
```
sample call
curl -X POST --url http://localhost:8000/api/v1/delete_scan --data "hash=77a9be5009f7ca26534b58fe57f8d712" -H "Authorization:c086ee4154e11b189d2a4a20daf40b5158bfd301784a46bbff4a5ff207389774"

request:
method post
hash of scan to delete
authorization header
respnse:
unable to delte as it is used by another process

```
![image](https://github.com/radha-m0wn1ka/radha-m0wn1ka.github.io/assets/64199052/b3cfe7be-f480-4015-b6c4-decbba7fda4f)
## get score card
```
samle call
                                                                     
curl -X POST --url http://localhost:8000/api/v1/scorecard --data "hash=77a9be5009f7ca26534b58fe57f8d712" -H "Authorization:c086ee4154e11b189d2a4a20daf40b5158bfd301784a46bbff4a5ff207389774"
request part:
hash of scan which implies the apk
authorization header
```
got repodrt not found
![image](https://github.com/radha-m0wn1ka/radha-m0wn1ka.github.io/assets/64199052/76b157f7-f4b5-44da-8ee3-8a4a10ef425d)
```
as we delted it in previous step we have to reperform the step,now the respnse is 
```
![image](https://github.com/radha-m0wn1ka/radha-m0wn1ka.github.io/assets/64199052/1e01ecdc-0374-4326-bd89-99207b447f16)

## generate pdf report
```
sample call
curl -X POST --url http://localhost:8000/api/v1/download_pdf --data "hash=77a9be5009f7ca26534b58fe57f8d712" -H "Authorization:c086ee4154e11b189d2a4a20daf40b5158bfd301784a46bbff4a5ff207389774"
 requests:
post to :/api/v1/download_pdf
hash of scanf
```
![image](https://github.com/radha-m0wn1ka/radha-m0wn1ka.github.io/assets/64199052/eaf42087-5d3c-4d48-8fcf-df0c4396d696)
```
hence
https://github.com/JazzCore/python-pdfkit/wiki/Installing-wkhtmltopdf
added this path to env vars
C:\Program Files\wkhtmltopdf\bin
still the same it cant find wkhtml to pdf
may be we have to restart not just the terminal through which we call api
may  be need to restart the mobsf as well
```
![image](https://github.com/radha-m0wn1ka/radha-m0wn1ka.github.io/assets/64199052/32d90719-af47-4c80-bdf5-b709037e78b7)
![image](https://github.com/radha-m0wn1ka/radha-m0wn1ka.github.io/assets/64199052/2569c60c-98f3-41f3-9062-7827a9439bae)


```
that is the issue after restraing both it works fine
```
## generate json report
```
sample call
curl -X POST --url http://localhost:8000/api/v1/report_json --data "hash=77a9be5009f7ca26534b58fe57f8d712" -H "Authorization:c086ee4154e11b189d2a4a20daf40b5158bfd301784a46bbff4a5ff207389774"
request:
authorization header
hash of scan
response:
got json res
```
![image](https://github.com/radha-m0wn1ka/radha-m0wn1ka.github.io/assets/64199052/57841d29-ac99-4550-9467-0516e466e14a)
## view source files
```
sample call
curl -X POST --url http://localhost:8000/api/v1/view_source --data "hash=77a9be5009f7ca26534b58fe57f8d712&type=apk&file=classdump.txt" -H "Authorization:c086ee4154e11b189d2a4a20daf40b5158bfd301784a46bbff4a5ff207389774"
```
![image](https://github.com/radha-m0wn1ka/radha-m0wn1ka.github.io/assets/64199052/39f822a1-39a0-48aa-9302-d7fbd229b1d2)

## compare apps
```
hash 1::e64f5db697db0567e9e71e07f3b58863--this hash is not generated by cmd line it is md5 hash
hash2:77a9be5009f7ca26534b58fe57f8d712
sample call:--
curl -X POST --url http://localhost:8000/api/v1/compare --data "hash1=e64f5db697db0567e9e71e07f3b58863&hash2=77a9be5009f7ca26534b58fe57f8d712" -H "Authorization:c086ee4154e11b189d2a4a20daf40b5158bfd301784a46bbff4a5ff207389774"
so did another upload the hash is "d57f6acb9af3bab1ee6e0785651a1bfb",


```

![image](https://github.com/radha-m0wn1ka/radha-m0wn1ka.github.io/assets/64199052/2becfc4f-3b7e-428f-84a4-7164e7056e44)

```
another scan
curl -X POST --url http://localhost:8000/api/v1/scan --data "hash=d57f6acb9af3bab1ee6e0785651a1bfb" -H "Authorization:c086ee4154e11b189d2a4a20daf40b5158bfd301784a46bbff4a5ff207389774"
scanning is done
```
```
now comparing
curl -X POST --url http://localhost:8000/api/v1/compare --data "hash1=d57f6acb9af3bab1ee6e0785651a1bfb&hash2=77a9be5009f7ca26534b58fe57f8d712" -H "Authorization:c086ee4154e11b189d2a4a20daf40b5158bfd301784a46bbff4a5ff207389774"
```
![image](https://github.com/radha-m0wn1ka/radha-m0wn1ka.github.io/assets/64199052/a00d99d2-e196-4217-b4e5-2a451cd78382)
## suppress by rule
```
samle call:--
curl -X POST --url http://localhost:8000/api/v1/suppress_by_rule --data "hash=d57f6acb9af3bab1ee6e0785651a1bfb&type=manifest&rule=app_allowbackup" -H "Authorization:c086ee4154e11b189d2a4a20daf40b5158bfd301784a46bbff4a5ff207389774"

curl -X POST --url http://localhost:8000/api/v1/suppress_by_rule --data "hash=77a9be5009f7ca26534b58fe57f8d712&type=manifest&rule=app_allowbackup" -H "Authorization:c086ee4154e11b189d2a4a20daf40b5158bfd301784a46bbff4a5ff207389774"
```
![image](https://github.com/radha-m0wn1ka/radha-m0wn1ka.github.io/assets/64199052/44002778-5310-4706-be72-da8d6e4b0af0)
```

curl -X POST --url http://localhost:8000/api/v1/suppress_by_rule --data "hash=77a9be5009f7ca26534b58fe57f8d712&type=code&rule=android_logging" -H "Authorization:c086ee4154e11b189d2a4a20daf40b5158bfd301784a46bbff4a5ff207389774"
```
## supress by files
```
sample call
curl -X POST --url http://localhost:8000/api/v1/suppress_by_files --data "hash=77a9be5009f7ca26534b58fe57f8d712&type=code&rule=app_allowbackup" -H "Authorization:c086ee4154e11b189d2a4a20daf40b5158bfd301784a46bbff4a5ff207389774"
```
![image](https://github.com/radha-m0wn1ka/radha-m0wn1ka.github.io/assets/64199052/3003a41a-0df7-4e95-a74b-402fad46edff)
## view suppresson
```
sample call
curl -X POST --url http://localhost:8000/api/v1/list_suppressions --data "hash=77a9be5009f7ca26534b58fe57f8d712" -H "Authorization:c086ee4154e11b189d2a4a20daf40b5158bfd301784a46bbff4a5ff207389774"
```
![image](https://github.com/radha-m0wn1ka/radha-m0wn1ka.github.io/assets/64199052/d39e347f-9af7-4fc3-b11f-317f670e2e1b)


# dynamic analysis
## Get Apps
```
sample call
curl --url http://localhost:8000/api/v1/dynamic/get_apps -H "Authorization:c086ee4154e11b189d2a4a20daf40b5158bfd301784a46bbff4a5ff207389774"
```
![image](https://github.com/radha-m0wn1ka/radha-m0wn1ka.github.io/assets/64199052/d7049a92-63b7-4ac5-9bd7-86ab706d665b)
```
set VARIABLE_NAME=value
set MOBSF_ANALYZER_IDENTIFIER =192.168.69.102:5555

restart all terminals including mobsf

c086ee4154e11b189d2a4a20daf40b5158bfd301784a46bbff4a5ff207389774

```
![image](https://github.com/radha-m0wn1ka/radha-m0wn1ka.github.io/assets/64199052/38d3e31e-0488-4b93-bd9b-2b9b8a50541b)
## start dynamic analysis
```
curl -X POST --url http://localhost:8000/api/v1/dynamic/start_analysis --data "hash=77a9be5009f7ca26534b58fe57f8d712" -H "Authorization:c086ee4154e11b189d2a4a20daf40b5158bfd301784a46bbff4a5ff207389774"
```
![image](https://github.com/radha-m0wn1ka/radha-m0wn1ka.github.io/assets/64199052/b272ac4e-d497-48b1-900b-7f914ecbadaa)
```
we used diva beta apke it gave above errr
now i manually check app-relase apk it is compatible with andoid
so let us perform static analysis and get hash then perform dyanamic analysis
curl -F file=@/Users/radha/Desktop/app-release.apk http://localhost:8000/api/v1/upload -H "Authorization:c086ee4154e11b189d2a4a20daf40b5158bfd301784a46bbff4a5ff207389774" and hash is "d57f6acb9af3bab1ee6e0785651a1bfb",

```
![image](https://github.com/radha-m0wn1ka/radha-m0wn1ka.github.io/assets/64199052/b65cba36-622b-4023-9376-7114a0cbcc3e)
```

curl -X POST --url http://localhost:8000/api/v1/scan --data "hash=d57f6acb9af3bab1ee6e0785651a1bfb" -H "Authorization:c086ee4154e11b189d2a4a20daf40b5158bfd301784a46bbff4a5ff207389774"
now did scanning in static anaylis
curl -X POST --url http://localhost:8000/api/v1/dynamic/start_analysis --data "hash=d57f6acb9af3bab1ee6e0785651a1bfb" -H "Authorization:c086ee4154e11b189d2a4a20daf40b5158bfd301784a46bbff4a5ff207389774"
```
![image](https://github.com/radha-m0wn1ka/radha-m0wn1ka.github.io/assets/64199052/d05f7762-6a2a-4278-a406-71549394c2e7)
## view log cat
```
curl -X POST --url http://localhost:8000/api/v1/android/logcat --data "package=org.wikipedia" -H "Authorization:c086ee4154e11b189d2a4a20daf40b5158bfd301784a46bbff4a5ff207389774"
```
![image](https://github.com/radha-m0wn1ka/radha-m0wn1ka.github.io/assets/64199052/3b979e49-1bd7-4408-938c-f8c3b5833a60)

# 6-12-2023
# 06-12-2023
## run.bat
```
windows batch script used to run MobSF (Mobile Security Framework) using the `Waitress` server

@echo off: This command turns off the command echoing, which means the commands themselves won't be displayed in the console as they are executed.

waitress-serve: This is the command to start the Waitress server. Waitress is a production-quality pure-Python WSGI server.

WSGI (Web Server Gateway Interface
source of run.bat
```
```
@echo off
if [%1]=="access_key123" goto run else echo invalid accesskey exit 0
if [%2]==[] goto usage
SET conf=%2

goto :run
:usage
SET conf="0.0.0.0:8000 [::]:8000"
:run
echo Running MobSF by radhamouni on %conf%
poetry run waitress-serve --listen=%conf% --threads=10 --channel-timeout=3600 mobsf.MobSF.wsgi:application
```
## how to implement protection to access the mobsf api
```
may be while running run.bat 127.0.0.1:8000
we need to provide the access key like this run.bat 127.0.0.1:8000 ACCESS_KEY
and we can check it with a hardcoded api key before going to run label
so we can modify it like first argument is accesskey and second argument is address at which we want to run (port number) 
```
## modifying so that only user with access key will be allowed to run it
```
@echo off
if "%1"=="access_key123" (
    goto auth
) else (
    echo Invalid-access-key
    exit /b 1
)

:auth
if [%2]==[] goto usage
SET conf=%2
goto :run

:usage
SET conf=0.0.0.0:8000 [::]:8000

:run
echo Running MobSF by radhamounksi on %conf%
poetry run waitress-serve --listen=%conf% --threads=10 --channel-timeout=3600 mobsf.MobSF.wsgi:application

```
```
here waitress serve is serving the mobsf/MobSF/wsgi and application has the wsgi application
so let us analyse that source code to see how to implement protection from there
```
![image](https://github.com/radha-m0wn1ka/radha-m0wn1ka.github.io/assets/64199052/c738ce52-4ac6-48a4-aefc-f895be6246d9)
![image](https://github.com/radha-m0wn1ka/radha-m0wn1ka.github.io/assets/64199052/eb863c0d-3213-4c3c-8c7e-8409853107db)


```
"""
WSGI config for MobSF project.

It exposes the WSGI callable as a module-level variable named ``application``.

For more information on this file, see
https://docs.djangoproject.com/en/dev/howto/deployment/wsgi/
"""
import os
import warnings

from django.core.wsgi import get_wsgi_application

from whitenoise import WhiteNoise

from . import settings


warnings.filterwarnings('ignore', category=UserWarning, module='cffi')
os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'mobsf.MobSF.settings')

static = os.path.join(settings.BASE_DIR, 'static')
application = WhiteNoise(get_wsgi_application(),
                         root=static, prefix='static/')
```
## understasing wsgi.py
```
WhiteNoise: A middleware for serving static files efficiently in a WSGI environment

we filter any warings from cffi module (used for python c binding)
```
## setting file
```
os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'mobsf.MobSF.settings')
so we get setting from here
from  setting file we can say where download dir,screenshot dirs,upload dirs,db dirs
allowed extensions,mime types
colors of error,info in output
```
# 07-12-2023

# 07-12-2023
## streamlit
- https://github.com/ccrazy-racer/mobsf_streamlit
```
steramlit building webapps and deploying them without html,css,js
import streamlit as st
st.title('..')
st.header("..')
st.text('...')
df = pd.read_csv("my_data.csv")
st.line_chart(df)
# Running
python -m streamlit run your_script.py
# is equivalent to:
streamlit run your_script.py
now
git clone https://github.com/ccrazy-racer/mobsf_streamlit
```
### structure
![image](https://github.com/m0wn1ka/mobsf/assets/127676379/4ea317d1-6591-4741-b8b9-cc3472b68409)
#### fetch api key.py
```
in this file
it uses beautiful soup module to get the api key from our 127.0.0.1:8000 url with class name code
and it returns the api key
```
#### flask app.py
```
 Flask framework. Flask is a popular micro framework for building web applications
here routes will be defined  for upload ing file ,scaning etc
````
### run_all_apps.py
```
it first makes sure mobsf is running in  docker then streamlit .py,flask .py will be run
```
### streamlit app.py
```
here some level of ui is defined using flask and it uses teh post api calls using requests module to mobsf
it is just another ui for mobsf with our defined ui
```
### high level view
```
at port 81 flask appliation will run with defined routes :flask.py
in stream lit app .py
             SERVER_URL = 'http://127.0.0.1:81'
            response = requests.post(f'{SERVER_URL}/api/v1/upload', data=multipart_data, headers=headers)
              means in this ui we send request to the port 81 where methods are defined to call to 8000
i.e at 81 ui and requests port 8000
in run all apps.py we start running  mobsf in docker and start all the above apps
```
### doing
```
python run_all_apps.py ---in terminal1
it appers the above is not running stremlit app as expected so 
PS C:\Users\radha\Downloads\mobSF\mobsf_streamlit> python streamlit_app.py
2023-12-07 05:47:33.953 
  Warning: to view this Streamlit app on a browser, run it with the following
  command:

    streamlit run streamlit_app.py [ARGUMENTS]
2023-12-07 05:47:33.953 Session state does not function when running a script without `streamlit run`

$streamlit run streamlit_app.py

      Welcome to Streamlit!
You can now view your Streamlit app in your browser.

  Local URL: http://localhost:8501
  Network URL: http://192.168.123.165:8501
```
![image](https://github.com/m0wn1ka/mobsf/assets/127676379/5207c11f-6dd7-4e64-949b-102dd7f39610)
```
so here we can implement login
```
## streamlit authntication
```
https://docs.kanaries.net/topics/Streamlit/streamlit-authentication
https://docs.streamlit.io/knowledge-base/deploy/authentication-without-sso
```
### normal authentication mechanism in streamlit
```
st.session_state["variable_name"] = some_value
st.session_state is a feature in Streamlit that allows you to store and retrieve variables across different points in your Streamlit app during a single user session.
When you first use st.session_state in your Streamlit app, it automatically creates a namespace for your session to store variables


The st.secrets functionality in Streamlit is designed to work with secrets stored in a file named secrets.toml within the Streamlit app directory. This file can be created manually, and it's a convenient way to store sensitive information like API keys, passwords, etc
```
#### sample secrets.toml and accessing it
```
[passwords]
user1 = "password_for_user1"
user2 = "password_for_user2"

[api_keys]
weather_api_key = "api_key"

accessing it
user1_password = st.secrets["passwords"]["user1"]
```
#### updating secrets .toml 
```
import streamlit as st
import toml

# Load existing secrets
secrets_file_path = "secrets.toml"
secrets = toml.load(secrets_file_path)

# Display the current secrets
st.write("Current Secrets:", secrets)

# Update secrets interactively
new_password = st.text_input("Enter a new password for user1:")
secrets["passwords"]["user1"] = hashlib.sha256(new_password.encode()).hexdigest()

# Save the updated secrets back to the file
with open(secrets_file_path, "w") as file:
    toml.dump(secrets, file) 

st.success("Secrets updated successfully!")
toml.dump()  convert  into toml format  ,param1=what should be written or converted,parm2=where must be written 
```
## streamlit_app.py
define secrets.toml at .steamlite/
```
import streamlit as st
import requests
from requests_toolbelt.multipart.encoder import MultipartEncoder
import json
import webbrowser
import time
from datetime import date
import os

today = date.today()




# Define the path to the directory where reports are stored
reports_directory = 'reports'  # Replace with your actual directory path

# Function to get a list of apps
def get_apps():
    app_list = os.listdir(reports_directory)
    return app_list

# Function to get a list of reports for a specific app
def get_reports(app_name):
    app_reports = []
    app_dir = os.path.join(reports_directory, app_name)
    if os.path.exists(app_dir):
        app_reports = sorted(os.listdir(app_dir), reverse=True)
    return app_reports


# Function to create or check the existence of a folder for the app
def create_or_check_app_folder(app_name):
    app_dir = os.path.join(reports_directory, app_name)
    if not os.path.exists(app_dir):
        os.makedirs(app_dir)
    return app_dir

def streamlit():
    tab1, tab2 = st.tabs(["Scan App", " 🕓 Recent Scans"])
    
    # Define the API key and server URL
    SERVER_URL = 'http://127.0.0.1:81'
    tab1.title("File Upload and Scan")

    # Initialize session_state
    if 'api_data' not in st.session_state:
        st.session_state.api_data = None
    if 'file_name' not in st.session_state:
        st.session_state.file_name = None
    if 'uploaded' not in st.session_state:
        st.session_state.uploaded = None


    
    
    # Upload file
    uploaded_file = tab1.file_uploader("Choose a file:")

    if uploaded_file:
        tab1.write("File selected successfully")

        # Define the "Upload and Scan" button
        if tab1.button("Upload"):
            # Perform file upload and scan
            tab1.write("Uploading the file...")

            multipart_data = MultipartEncoder(fields={'file': (uploaded_file.name, uploaded_file, 'application/octet-stream')})
            headers = {'Content-Type': multipart_data.content_type}
            response = requests.post(f'{SERVER_URL}/api/v1/upload', data=multipart_data, headers=headers)
            
            if response.status_code == 200:
                tab1.write("Upload completed successfully.")
                resp = json.loads(response.text)
                st.session_state.api_data = resp['hash']
                st.session_state.file_name = resp['file_name']
                st.session_state.uploaded = True
            else:
                tab1.write(f"Upload failed: {response.text}")

        # Scan file
        if st.session_state.uploaded == True:
            if tab1.button("Scan"):
                tab1.write("Scanning the file...")
                headers = {'Content-Type': 'application/json'}
                scan_response = requests.get(f'{SERVER_URL}/api/v1/scan/{st.session_state.api_data}', headers=headers)        
                if scan_response.status_code == 200:
                    print(scan_response.text)
                    tab2.write("Wait for 2 minutes do not refresh page... later press on download...")
                else:
                    tab1.write(f"Scan failed: {scan_response.text}")

            # Download report button
            if tab1.button("Download Report"):
                    tab1.write("Downloading report...")
                    
                    # Define the report download URL and save the report locally
                    download_url = f'{SERVER_URL}/api/v1/download_pdf/{st.session_state.api_data}'
                    response = requests.get(download_url, stream=True)

                    if response.status_code == 200:
                        app_folder = create_or_check_app_folder(st.session_state.file_name)
                        with open(os.path.join(app_folder,f"{st.session_state.file_name}_report_{today.strftime('%b-%d-%Y')}.pdf"), "wb") as pdf_file:
                            for chunk in response.iter_content(chunk_size=1024):
                                if chunk:
                                    pdf_file.write(chunk)
                        tab1.write("Report downloaded as report.pdf")
                    else:
                        tab1.write(f"Report download failed: {response.text}")
                        
                        
    # Streamlit UI
    # st.title("Recent Scans")

    # Button to view recent scans
    tab2.title("Recent Scans")
    tab2.header("Apps")
    app_list = get_apps()
    selected_app = tab2.selectbox("Select an App", app_list, index=None, placeholder="Select an app...",)

    if selected_app:
        tab2.header(f"Reports for {selected_app}")
        app_reports = get_reports(selected_app)
        
        if not app_reports:
            tab2.write(f"No reports found for {selected_app}.")
        else:
            tab2.write("Select a report to view or download:")
            selected_report = tab2.selectbox("Select a Report", app_reports, index=None, placeholder="Select any report...",)
            if selected_report:
                report_path = os.path.join(reports_directory, selected_app, selected_report)

                if selected_report.lower().endswith('.pdf'):
                    # Provide a download button for the PDF
                    with open(report_path, "rb") as pdf_file:
                        PDFbyte = pdf_file.read()
                    tab2.download_button(label="Download report", data= PDFbyte, file_name= selected_report)
                else:
                    tab2.write("This report is not a PDF file and cannot be displayed.")
                    




#----------------
# streamlit_app.py

import hmac


def check_password():
    """Returns `True` if the user had a correct password."""

    def login_form():
        """Form with widgets to collect user information"""
        with st.form("Credentials"):
            st.text_input("Username", key="username")
            st.text_input("Password", type="password", key="password")
            st.form_submit_button("Log in", on_click=password_entered)

    def password_entered():
        """Checks whether a password entered by the user is correct."""
        if st.session_state["username"] in st.secrets[
            "passwords"
        ] and hmac.compare_digest(
            st.session_state["password"],
            st.secrets.passwords[st.session_state["username"]],
        ):
            st.session_state["password_correct"] = True
            del st.session_state["password"]  # Don't store the username or password.
            del st.session_state["username"]
        else:
            st.session_state["password_correct"] = False

    # Return True if the username + password is validated.
    if st.session_state.get("password_correct", False):
        return True

    # Show inputs for username + password.
    login_form()
    if "password_correct" in st.session_state:
        st.error("😕 User not known or password incorrect")
    return False


if not check_password():
    st.stop()

# Main Streamlit app starts here


#---------------

if __name__ == '__main__':
    streamlit()
```
![image](https://github.com/m0wn1ka/mobsf/assets/127676379/c6e0ab06-73a2-4a24-b3b6-9ca60c23b0fb)
![image](https://github.com/m0wn1ka/mobsf/assets/127676379/56e81419-5b85-4d3e-8239-7afc6a4a273e)
![image](https://github.com/m0wn1ka/mobsf/assets/127676379/d28286f1-768b-444a-a5d2-e879d64ed9b1)
![image](https://github.com/m0wn1ka/mobsf/assets/127676379/6ae53dd5-66ef-483f-8075-38ac98dcbea1)


## ...
```
added authentication to mobsf
ref
https://docs.streamlit.io/knowledge-base/deploy/authentication-without-sso
https://github.com/ccrazy-racer/mobsf_streamlit
```





















